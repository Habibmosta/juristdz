<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Bouton de Traduction Direct</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .chat-header {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .translate-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 12px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
        }
        .translate-btn:hover {
            background: #0056b3;
        }
        .translate-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }
        .language-selector {
            margin-right: 10px;
        }
        .language-selector select {
            padding: 8px 12px;
            font-size: 14px;
            border-radius: 8px;
            border: 1px solid #ddd;
        }
        .messages {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .message {
            margin: 15px 0;
            padding: 15px;
            border-radius: 10px;
            border-left: 4px solid #007bff;
            background: #f8f9fa;
        }
        .message.translated {
            border-left-color: #28a745;
            background: #d4edda;
        }
        .message.user {
            border-left-color: #6c757d;
            background: #e9ecef;
        }
        .message.bot {
            border-left-color: #ffc107;
            background: #fff3cd;
        }
        .status {
            margin: 10px 0;
            padding: 10px;
            border-radius: 5px;
            background: #e9ecef;
            font-weight: bold;
        }
        .mixed-content {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .mixed-content h3 {
            margin-top: 0;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="mixed-content">
        <h3>ğŸš¨ ProblÃ¨me de mÃ©lange de langues dÃ©tectÃ© !</h3>
        <p>Voici un exemple du problÃ¨me que vous rencontrez :</p>
        <div style="font-family: monospace; background: white; padding: 10px; border-radius: 4px;">
            Ù…ØªØµÙ„Ù…Ø­Ø§Ù…ÙŠÙ„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…Ø¨Ø­Ø« Ù‚Ø§Ù†ÙˆÙ†ÙŠØªØ­Ø±ÙŠØ±ØªØ­Ù„ÙŠÙ„Ù…Ù„ÙØ§ØªÙˆØ«Ø§Ø¦Ù‚Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø³Ø±ÙŠØ¹Ø©+ Ù…Ù„Ù Ø¬Ø¯ÙŠØ¯+ Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹arÙˆØ¶Ø¹ Ø¢Ù…Ù†
        </div>
        <p><strong>Solution :</strong> Utilisez le bouton "Traduire les messages" ci-dessous pour corriger ce problÃ¨me.</p>
    </div>

    <div class="chat-header">
        <div>
            <h1>ğŸ§ª Test du Bouton de Traduction Direct</h1>
            <p>Simulation de votre interface ChatInterface</p>
        </div>
        <div style="display: flex; align-items: center; gap: 10px;">
            <div class="language-selector">
                <label for="language">Langue :</label>
                <select id="language">
                    <option value="fr">FranÃ§ais</option>
                    <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©</option>
                </select>
            </div>
            
            <button class="translate-btn" id="translateBtn">
                ğŸŒ <span id="btnText">Traduire les messages</span>
            </button>
        </div>
    </div>
    
    <div class="status" id="status">
        PrÃªt Ã  traduire
    </div>
    
    <div class="messages" id="messages">
        <div class="message user" data-id="1" data-original="ayant droits" data-lang="fr">
            <strong>ğŸ‘¤ Utilisateur:</strong><br>
            <span class="text">ayant droits</span>
        </div>
        
        <div class="message bot" data-id="2" data-original="Vous souhaitez connaÃ®tre les droits dont vous disposez en AlgÃ©rie. Voici quelques informations gÃ©nÃ©rales sur les droits fondamentaux, civils, pÃ©naux et familiaux selon la lÃ©gislation algÃ©rienne." data-lang="fr">
            <strong>ğŸ¤– Assistant:</strong><br>
            <span class="text">Vous souhaitez connaÃ®tre les droits dont vous disposez en AlgÃ©rie. Voici quelques informations gÃ©nÃ©rales sur les droits fondamentaux, civils, pÃ©naux et familiaux selon la lÃ©gislation algÃ©rienne.</span>
        </div>
        
        <div class="message bot" data-id="3" data-original="Les droits fondamentaux incluent le droit Ã  la vie, la libertÃ© et la sÃ©curitÃ© selon l'Article 24 de la Constitution algÃ©rienne." data-lang="fr">
            <strong>ğŸ¤– Assistant:</strong><br>
            <span class="text">Les droits fondamentaux incluent le droit Ã  la vie, la libertÃ© et la sÃ©curitÃ© selon l'Article 24 de la Constitution algÃ©rienne.</span>
        </div>
    </div>

    <script>
        // Service de traduction amÃ©liorÃ©
        class ImprovedTranslationService {
            constructor() {
                this.translationPairs = {
                    'fr_to_ar': {
                        'ayant droits': 'Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø­Ù‚ÙˆÙ‚',
                        'Vous souhaitez connaÃ®tre les droits dont vous disposez en AlgÃ©rie. Voici quelques informations gÃ©nÃ©rales sur les droits fondamentaux, civils, pÃ©naux et familiaux selon la lÃ©gislation algÃ©rienne.': 'ØªØ±ÙŠØ¯ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ø§Ù„ØªÙŠ ØªØªÙ…ØªØ¹ Ø¨Ù‡Ø§ ÙÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±. Ø¥Ù„ÙŠÙƒ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ø­ÙˆÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„Ù…Ø¯Ù†ÙŠØ© ÙˆØ§Ù„Ø¬Ù†Ø§Ø¦ÙŠØ© ÙˆØ§Ù„Ø¹Ø§Ø¦Ù„ÙŠØ© ÙˆÙÙ‚Ø§Ù‹ Ù„Ù„ØªØ´Ø±ÙŠØ¹ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ.',
                        'Les droits fondamentaux incluent le droit Ã  la vie, la libertÃ© et la sÃ©curitÃ© selon l\'Article 24 de la Constitution algÃ©rienne.': 'Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ØªØ´Ù…Ù„ Ø§Ù„Ø­Ù‚ ÙÙŠ Ø§Ù„Ø­ÙŠØ§Ø© ÙˆØ§Ù„Ø­Ø±ÙŠØ© ÙˆØ§Ù„Ø£Ù…Ø§Ù† ÙˆÙÙ‚Ø§Ù‹ Ù„Ù„Ù…Ø§Ø¯Ø© 24 Ù…Ù† Ø§Ù„Ø¯Ø³ØªÙˆØ± Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ.'
                    },
                    'ar_to_fr': {
                        'Ø£ØµØ­Ø§Ø¨ Ø§Ù„Ø­Ù‚ÙˆÙ‚': 'ayant droits',
                        'ØªØ±ÙŠØ¯ Ù…Ø¹Ø±ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ø§Ù„ØªÙŠ ØªØªÙ…ØªØ¹ Ø¨Ù‡Ø§ ÙÙŠ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±. Ø¥Ù„ÙŠÙƒ Ø¨Ø¹Ø¶ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¹Ø§Ù…Ø© Ø­ÙˆÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ÙˆØ§Ù„Ù…Ø¯Ù†ÙŠØ© ÙˆØ§Ù„Ø¬Ù†Ø§Ø¦ÙŠØ© ÙˆØ§Ù„Ø¹Ø§Ø¦Ù„ÙŠØ© ÙˆÙÙ‚Ø§Ù‹ Ù„Ù„ØªØ´Ø±ÙŠØ¹ Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ.': 'Vous souhaitez connaÃ®tre les droits dont vous disposez en AlgÃ©rie. Voici quelques informations gÃ©nÃ©rales sur les droits fondamentaux, civils, pÃ©naux et familiaux selon la lÃ©gislation algÃ©rienne.',
                        'Ø§Ù„Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© ØªØ´Ù…Ù„ Ø§Ù„Ø­Ù‚ ÙÙŠ Ø§Ù„Ø­ÙŠØ§Ø© ÙˆØ§Ù„Ø­Ø±ÙŠØ© ÙˆØ§Ù„Ø£Ù…Ø§Ù† ÙˆÙÙ‚Ø§Ù‹ Ù„Ù„Ù…Ø§Ø¯Ø© 24 Ù…Ù† Ø§Ù„Ø¯Ø³ØªÙˆØ± Ø§Ù„Ø¬Ø²Ø§Ø¦Ø±ÙŠ.': 'Les droits fondamentaux incluent le droit Ã  la vie, la libertÃ© et la sÃ©curitÃ© selon l\'Article 24 de la Constitution algÃ©rienne.'
                    }
                };
            }

            async translateText(text, fromLang, toLang) {
                console.log(`ğŸ”„ Traduction: "${text}" de ${fromLang} vers ${toLang}`);
                
                if (fromLang === toLang) {
                    return text;
                }

                const key = `${fromLang}_to_${toLang}`;
                const translations = this.translationPairs[key];
                
                if (translations && translations[text]) {
                    const result = translations[text];
                    console.log(`âœ… Traduction trouvÃ©e: "${result}"`);
                    return result;
                }
                
                // Traduction de base pour les mots simples
                if (toLang === 'ar') {
                    if (text.includes('droit')) return text.replace(/droit/g, 'Ø­Ù‚');
                    if (text.includes('libertÃ©')) return text.replace(/libertÃ©/g, 'Ø­Ø±ÙŠØ©');
                    if (text.includes('Constitution')) return text.replace(/Constitution/g, 'Ø§Ù„Ø¯Ø³ØªÙˆØ±');
                }
                
                console.log(`âš ï¸ Pas de traduction spÃ©cifique, retour du texte original`);
                return text;
            }

            detectLanguage(text) {
                const arabicRegex = /[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF]/;
                return arabicRegex.test(text) ? 'ar' : 'fr';
            }
        }

        // Initialisation
        const translationService = new ImprovedTranslationService();
        const translateBtn = document.getElementById('translateBtn');
        const btnText = document.getElementById('btnText');
        const languageSelect = document.getElementById('language');
        const statusDiv = document.getElementById('status');
        const messagesDiv = document.getElementById('messages');

        // Fonction de traduction (identique Ã  celle intÃ©grÃ©e dans ChatInterface)
        async function translateMessages() {
            const targetLanguage = languageSelect.value;
            const messages = messagesDiv.querySelectorAll('.message');
            
            console.log(`ğŸŒ DÃ©but de la traduction vers ${targetLanguage}`);
            statusDiv.textContent = `Traduction en cours vers ${targetLanguage === 'ar' ? 'l\'arabe' : 'le franÃ§ais'}...`;
            translateBtn.disabled = true;
            btnText.textContent = 'Traduction en cours...';

            try {
                for (let messageEl of messages) {
                    const originalText = messageEl.dataset.original;
                    const originalLang = messageEl.dataset.lang;
                    const textSpan = messageEl.querySelector('.text');
                    
                    console.log(`ğŸ“ Traitement: "${originalText.substring(0, 50)}..."`);
                    
                    if (originalLang === targetLanguage) {
                        // MÃªme langue, afficher le texte original
                        textSpan.textContent = originalText;
                        messageEl.classList.remove('translated');
                        console.log(`âœ… MÃªme langue, texte original affichÃ©`);
                    } else {
                        try {
                            const translatedText = await translationService.translateText(
                                originalText, 
                                originalLang, 
                                targetLanguage
                            );
                            
                            console.log(`âœ… RÃ©sultat: "${translatedText.substring(0, 50)}..."`);
                            
                            textSpan.textContent = translatedText;
                            
                            if (translatedText !== originalText) {
                                messageEl.classList.add('translated');
                                console.log(`âœ… Traduction rÃ©ussie`);
                            } else {
                                messageEl.classList.remove('translated');
                                console.log(`âš ï¸ Pas de traduction disponible`);
                            }
                        } catch (error) {
                            console.error('âŒ Erreur de traduction:', error);
                            textSpan.textContent = originalText;
                            messageEl.classList.remove('translated');
                        }
                    }
                    
                    // DÃ©lai pour simuler la traduction rÃ©elle
                    await new Promise(resolve => setTimeout(resolve, 300));
                }
                
                statusDiv.textContent = `âœ… Traduction terminÃ©e vers ${targetLanguage === 'ar' ? 'l\'arabe' : 'le franÃ§ais'}`;
                console.log(`âœ¨ Traduction terminÃ©e avec succÃ¨s`);
                
            } catch (error) {
                console.error('âŒ Erreur de traduction globale:', error);
                statusDiv.textContent = `âŒ Erreur de traduction: ${error.message}`;
            } finally {
                translateBtn.disabled = false;
                btnText.textContent = targetLanguage === 'ar' ? 'ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„' : 'Traduire les messages';
            }
        }

        // Event listeners
        translateBtn.addEventListener('click', translateMessages);
        
        languageSelect.addEventListener('change', () => {
            const lang = languageSelect.value;
            statusDiv.textContent = `PrÃªt Ã  traduire vers ${lang === 'ar' ? 'l\'arabe' : 'le franÃ§ais'}`;
            btnText.textContent = lang === 'ar' ? 'ØªØ±Ø¬Ù…Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„' : 'Traduire les messages';
        });

        console.log('ğŸš€ Test du bouton de traduction direct initialisÃ©');
        console.log('ğŸ“‹ Instructions:');
        console.log('1. SÃ©lectionnez la langue cible');
        console.log('2. Cliquez sur "Traduire les messages"');
        console.log('3. Observez la traduction des messages');
    </script>
</body>
</html>